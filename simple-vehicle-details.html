<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Details - AutoScout24 Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6600;
        }

        .info-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .info-banner h2 {
            margin-bottom: 0.5rem;
        }

        .loading {
            text-align: center;
            padding: 4rem;
            font-size: 1.25rem;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 1rem;
            border-radius: 4px;
            margin: 2rem 0;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .image-gallery img {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
        }

        .thumbnail {
            width: 100%;
            aspect-ratio: 4/3;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 4px;
        }

        .thumbnail.active {
            border-color: #ff6600;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
            padding: 1.5rem 0;
            border-top: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
        }

        .spec-item {
            text-align: center;
        }

        .spec-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .spec-label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
        }

        .spec-value {
            font-size: 1.125rem;
            font-weight: bold;
        }

        .price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #ff6600;
            color: white;
        }

        .btn-primary:hover {
            background: #e55a00;
        }

        .btn-secondary {
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            border-color: #ff6600;
            color: #ff6600;
        }

        .description {
            line-height: 1.8;
            color: #555;
        }

        .sidebar {
            position: sticky;
            top: 2rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #e8f5e9;
            color: #4caf50;
            border-radius: 20px;
            font-size: 0.875rem;
            margin-right: 0.5rem;
        }

        code {
            background: #f0f0f0;
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üöó AutoScout24</div>
    </div>

    <div class="container">
        <div class="info-banner">
            <h2>üóÑÔ∏è Live Supabase Integration</h2>
            <p>This page fetches real data from your <code>listings-db-24jul</code> and <code>images</code> tables.</p>
            <p style="margin-top: 0.5rem; opacity: 0.9;">Change the vehicle ID in the URL: <code>?id=123</code></p>
        </div>

        <div id="content">
            <div class="loading">Loading vehicle data...</div>
        </div>
    </div>

    <script type="module">
        // Initialize Supabase client
        const SUPABASE_URL = 'https://dydqconnmzxbcxhtouue.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5ZHFjb25ubXp4YmN4aHRvdXVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNjQ3NTQsImV4cCI6MjA2ODc0MDc1NH0.kzzsbt5BKvmezNT-ja8XNyuY5yIGuZCDfw195zTDDDM';
        
        const { createClient } = supabase;
        const client = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Get vehicle ID from URL or use first available
        const urlParams = new URLSearchParams(window.location.search);
        let vehicleId = urlParams.get('id');

        async function fetchVehicle(id) {
            try {
                // Fetch vehicle data
                const { data: vehicle, error: vehicleError } = await client
                    .from('listings-db-24jul')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (vehicleError) throw vehicleError;
                if (!vehicle) throw new Error('Vehicle not found');

                // Fetch images
                const { data: images, error: imagesError } = await client
                    .from('images')
                    .select('*')
                    .eq('listing_id', id)
                    .order('image_order', { ascending: true });

                if (imagesError) console.warn('Error fetching images:', imagesError);

                return { vehicle, images: images || [] };
            } catch (error) {
                throw error;
            }
        }

        async function renderVehicle(data) {
            const { vehicle, images } = data;
            
            // Parse numeric values
            const price = parseFloat(vehicle.price);
            const mileage = parseFloat(vehicle.mileage);
            
            // Generate title
            const title = [
                vehicle.first_registration_year,
                vehicle.make_key,
                vehicle.model_key,
                vehicle.version_full_name
            ].filter(Boolean).join(' ');

            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="grid">
                    <div>
                        ${images.length > 0 ? `
                        <div class="card image-gallery">
                            <img id="mainImage" src="${images[0].key}" alt="${title}">
                            ${images.length > 1 ? `
                            <div class="thumbnails">
                                ${images.map((img, i) => `
                                    <img src="${img.key}" 
                                         class="thumbnail ${i === 0 ? 'active' : ''}" 
                                         onclick="changeImage('${img.key}', ${i})"
                                         alt="View ${i + 1}">
                                `).join('')}
                            </div>
                            ` : ''}
                        </div>
                        ` : '<div class="card">No images available</div>'}

                        <div class="card">
                            <h1>${title}</h1>
                            ${vehicle.teaser ? `<p style="color: #666; margin-bottom: 1rem;">${vehicle.teaser}</p>` : ''}

                            <div class="specs-grid">
                                <div class="spec-item">
                                    <div class="spec-icon">üìÖ</div>
                                    <div class="spec-label">Year</div>
                                    <div class="spec-value">${vehicle.first_registration_year || 'N/A'}</div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">üõ£Ô∏è</div>
                                    <div class="spec-label">Mileage</div>
                                    <div class="spec-value">${mileage ? mileage.toLocaleString() + ' km' : 'N/A'}</div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">‚ö°</div>
                                    <div class="spec-label">Power</div>
                                    <div class="spec-value">${vehicle.horse_power || 'N/A'}${vehicle.horse_power ? ' PS' : ''}</div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">‚öôÔ∏è</div>
                                    <div class="spec-label">Transmission</div>
                                    <div class="spec-value">${vehicle.transmission_type || 'N/A'}</div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">‚õΩ</div>
                                    <div class="spec-label">Fuel</div>
                                    <div class="spec-value">${vehicle.fuel_type || 'N/A'}</div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">üöó</div>
                                    <div class="spec-label">Body Type</div>
                                    <div class="spec-value">${vehicle.body_type || 'N/A'}</div>
                                </div>
                            </div>
                        </div>

                        ${vehicle.description ? `
                        <div class="card">
                            <h2 style="margin-bottom: 1rem;">Description</h2>
                            <div class="description">${vehicle.description}</div>
                        </div>
                        ` : ''}

                        <div class="card">
                            <h2 style="margin-bottom: 1rem;">Technical Details</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                                ${vehicle.body_color_text ? `<div><strong>Color:</strong> ${vehicle.body_color_text}</div>` : ''}
                                ${vehicle.doors ? `<div><strong>Doors:</strong> ${vehicle.doors}</div>` : ''}
                                ${vehicle.seats ? `<div><strong>Seats:</strong> ${vehicle.seats}</div>` : ''}
                                ${vehicle.kilo_watts ? `<div><strong>Power:</strong> ${vehicle.kilo_watts} kW</div>` : ''}
                                ${vehicle.cubic_capacity ? `<div><strong>Displacement:</strong> ${vehicle.cubic_capacity} cm¬≥</div>` : ''}
                                ${vehicle.cylinders ? `<div><strong>Cylinders:</strong> ${vehicle.cylinders}</div>` : ''}
                                ${vehicle.co2_emission ? `<div><strong>CO‚ÇÇ:</strong> ${vehicle.co2_emission} g/km</div>` : ''}
                                ${vehicle.consumption_combined ? `<div><strong>Consumption:</strong> ${vehicle.consumption_combined} l/100km</div>` : ''}
                                ${vehicle.drive_type ? `<div><strong>Drive:</strong> ${vehicle.drive_type}</div>` : ''}
                                ${vehicle.weight_curb ? `<div><strong>Weight:</strong> ${vehicle.weight_curb} kg</div>` : ''}
                            </div>
                        </div>

                        <div class="card" style="background: #f0f7ff; border-left: 4px solid #2196f3;">
                            <p><strong>üóÑÔ∏è Database Info:</strong></p>
                            <p style="margin-top: 0.5rem; font-size: 0.875rem;">
                                Listing ID: <code>${vehicle.id}</code> | 
                                Seller ID: <code>${vehicle.seller_id || 'N/A'}</code> | 
                                Status: <code>${vehicle.status || 'N/A'}</code> | 
                                Live: <code>${vehicle.is_live}</code>
                            </p>
                            <p style="margin-top: 0.5rem; font-size: 0.875rem;">
                                Images found: <strong>${images.length}</strong> | 
                                Fetched from <code>listings-db-24jul</code> and <code>images</code> tables
                            </p>
                        </div>
                    </div>

                    <div class="sidebar">
                        <div class="card">
                            <div class="price">CHF ${price ? price.toLocaleString() : 'N/A'}</div>
                            ${price ? `
                            <p style="color: #666; margin-bottom: 1rem;">
                                From CHF ${Math.round(price / 48).toLocaleString()} / month
                            </p>
                            <div style="padding: 1rem; background: #f0f7ff; border-radius: 4px; border-left: 4px solid #2196f3; margin-bottom: 1rem;">
                                <div style="font-weight: bold; color: #2196f3;">
                                    CHF ${Math.round(price / 60).toLocaleString()} / month
                                </div>
                                <div style="font-size: 0.875rem; color: #666; margin-top: 0.25rem;">
                                    Leasing available
                                </div>
                            </div>
                            ` : ''}
                            
                            <button class="btn btn-primary">‚úâÔ∏è Request Information</button>
                            <button class="btn btn-secondary">üì± Call Dealer</button>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.5rem;">
                                <button class="btn btn-secondary">‚≠ê Save</button>
                                <button class="btn btn-secondary">üìä Compare</button>
                            </div>

                            ${vehicle.warranty_type ? `
                            <div style="margin-top: 1rem;">
                                <span class="badge">‚úì Warranty</span>
                                ${vehicle.is_inspected ? '<span class="badge">‚úì Inspected</span>' : ''}
                            </div>
                            ` : ''}
                        </div>

                        ${vehicle.seller_id ? `
                        <div class="card">
                            <div style="height: 80px; background: #333; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-bottom: 1rem;">
                                DEALER
                            </div>
                            <h3 style="margin-bottom: 0.5rem;">Authorized Dealer</h3>
                            <p style="color: #666; font-size: 0.875rem; margin-bottom: 1rem;">Seller ID: ${vehicle.seller_id}</p>
                            <button class="btn btn-primary">Contact Dealer</button>
                            <button class="btn btn-secondary">View All Vehicles</button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        window.changeImage = function(src, index) {
            document.getElementById('mainImage').src = src;
            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === index);
            });
        };

        // Load vehicle data
        async function init() {
            try {
                // If no ID specified, get the first available vehicle
                if (!vehicleId) {
                    const { data, error } = await client
                        .from('listings-db-24jul')
                        .select('id')
                        .eq('is_live', true)
                        .eq('is_deleted', false)
                        .limit(1)
                        .single();

                    if (error || !data) {
                        throw new Error('No vehicles found in database');
                    }
                    vehicleId = data.id;
                }

                const vehicleData = await fetchVehicle(vehicleId);
                await renderVehicle(vehicleData);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <strong>Error loading vehicle:</strong> ${error.message}
                        <p style="margin-top: 0.5rem;">
                            Make sure you have data in your <code>listings-db-24jul</code> table with <code>is_live = true</code> and <code>is_deleted = false</code>.
                        </p>
                        <p style="margin-top: 0.5rem;">
                            Check the browser console for more details.
                        </p>
                    </div>
                `;
            }
        }

        init();
    </script>
</body>
</html>

